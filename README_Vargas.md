# PLEASE_SULI2021
Modifications on the PLEASE software program created by Maxwell Grady (mgrady3). Changes include a user input for patch size to account for small selection areas from data

#Abstract
The Electron Spectro-Microscopy (ESM) beamline at The National Synchrotron Light Source II (NSLS-II) in Brookhaven National Laboratory incorporates two tools that allow comprehensive investigation of 2D surfaces, and their topographic, structural, chemical, and magnetic properties, on the nanometer scale. With the use of X-ray photoemission electron microscopy and low-energy electron microscopy (XPEEM/LEEM), data of the atomic layers on a surface is obtained as images, while the electron, or photon energy is varied. There are two successful open-source software programs that allow us to visualize the structure of a surface and the ranges in electron intensity within its layers: the Python Low-Energy Electron Analysis SuitE (PLEASE), and ImageJ. While comparing these two methods, adjustment of the image’s contrast and sample area selection size were found as two important aspects for accurate data exploit and analysis, and these changes will be added to the PLEASE software. For such, I have been examining the python source code of the PLEASE program and was able to successfully add an input section and button for users to control the selection size, and began an image menu bar that will open a window for users to enhance the loaded image to their liking. Both allow for precise data extraction from a sample area, with its varying sizes in domain, and the improved ability to identify key features and location of interested sample areas. Up to this point this summer, I have learned how to extract the main spectroscopic data from the raw data in XPEEM/LEEM, and the tools needed for software development through python.

#Selection size patch width
An examination of the PLEASE source code files was needed to implement these changes. There are 14 python scripts used to run the PLEASE program, with the main ones needed for my modifications being the please.py script and the LEEMFUNCTIONS.py python script. The please.py file consists of 2,555 lines of code that call the other scripts as methods, creates the visual graphical user interface, and connects user events to error messages, other actions and more.  What I am interested in this script is the creation, and calling of the selection area patch width, which is what is used to print a circle and extract IV curve data from a user’s desired point. Within a method defined as “handleLEEMClick” Grady hard-codes, or defaults, the radius of the patch appended when the mouse is clicked to an integer of 8 pixels. This aspect is what I needed to change to have the user adjust the size of the circle’s radius.  
To maintain feasibility, I found that the most efficient method to change the patch width radius is through adding a section, input text box and button in the configuration tab that has already been coded into the interface. To my advantage, Dr. Grady’s code is extremely organized and commented, so I was able to find the methods I needed without too much strain in 2,555 lines of code. With a method that defined all the information to view in the configuration file, I could mimic his code and add what was needed for this modification. Figure 3 and Figure 4 show the before and after my addition in the configuration tab. 
Once the input section and button were connected, along with specific messages to keep the user input an even integer for a circle, I was then able to go into the handleLEEMclick method and assign the radius to equal the user’s input, rather than a default size. This completed function allows for the user to change the size of their selection area to their liking, which overall allows for the ability to see into very small features that could be present on a surface, and better’s the IV curves extracted at those points.

#Image Enhancement
The second desired alteration, an image enhancing feature, was found as necessary for clarification of loaded experiments, focusing of the image, and a method to adjust the brightness or contrast if needed. This ability would allow for clearer view of a surface’s characteristics for further data extraction. This method had more information in multiple python scripts compared to the patch width change function solely in the please.py script. For this function to work I needed to access the LEEMFUNCTIONS.py script, qthreads.py script, and create my own python script which I named adjImage.py to start modification. The first script had the methods to call the images from the user’s directory and transfers those data files into a 3D NumPy array to be outputted. While the data we receive from the XPEEM/LEEM microscope is in the form of images, they are downloaded as binary (.dat), rather than an image file (.jpg, .jpeg, .png). Because of this, when loading the experiment into the PLEASE program, to process that data and upload the image, it is converted into an array. 
My own adjImage.py python script was needed to test uploading an image and implementing editing modules. Imported imaging modules such as OpenCv, PILLOW, and Matplotlib were tried to execute this before adding them to the PLEASE program, though I found that this method needs to be within the program to function correctly. Therefore, I linked my script to the please.py file that calls the other python files, and in there added an Image menu bar, a button, and window for the user to open when prompted to enhance an image. 

#Results
The change in selection size was successfully programmed into the PLEASE software and allows for finer extraction of outputted IV data compared to the previously defaulted patch size. Figure 5, Figure 6, and Figure 7, show a comparison of three IV curve plots, done through the terminal graphing software Gnuplot, that prove enhancement in data taken from patch size that is inputted to fit a desired selection area. As this change is added and uploaded to GitHub, users will be able to download Grady’s program with my advancement.
The results from the image enhancement function are currently inconclusive. The image after loading into my own python script outputs distorted or not at all, which adds challenges to implementing an imaging module. The reason for this is the need for all the data files to be loaded together, and the size of the completed array once converted. The XPEEM/LEEM tools result in data in the form of images, as stated before, though rather than a few image files, they download together as a couple hundred. Therefore, when the process of converting the data to a 3D array has executed, the resulting size of the array is extremely large, and difficult to execute for the imaging modules. 
The next steps for the image editing process are to continue research in 3D NumPy arrays on whether I would be able to change the values in the array and what algorithms are needed to implement a contrast change to arrays. To do so, a trial is to be done by copying the variable that holds the already uploaded images, and attempt to open and edit that image in the window I created in the Image menu bar. Once these trials result in an output, the image enhancing method will be further developed to and allow for superior data analysis.

![image](https://user-images.githubusercontent.com/87339748/130362046-301dc353-768f-479a-b8a6-05848e711218.png)
Figure 1: A screenshot of the complete PLEASE program with a loaded experiment. The IV plot is to the right of the program and the loaded image data to the left. The plot corresponds with the crosshair position on the loaded experiment.

![image](https://user-images.githubusercontent.com/87339748/130362075-7af96d5b-303a-4552-835e-1f499185b79a.png)
![image](https://user-images.githubusercontent.com/87339748/130362081-17b5df93-e4ef-4ed1-baec-293cf80ed431.png)
Figure 2: ImageJ with a loaded raw data set, including the adjustment abilities on the left and the selection size variation available on the right.

![image](https://user-images.githubusercontent.com/87339748/130362091-4b458f1b-0c9e-42fd-a84a-b609ea44fa85.png)
Figure 3: Dr. Maxwell Grady’s PLEASE program downloaded directly from GitHub. The configuration file where the user can adjust aspects in the program before my addition.

![image](https://user-images.githubusercontent.com/87339748/130362097-4cfbe91e-5b95-43b7-9acc-0adfdbc1533e.png)
Figure 4: The configuration tab with my addition of patch size input. User is prompted to enter an even integer, click the “Apply Patch Settings,” button, and results in a changed circle when image is clicked on. 

![image](https://user-images.githubusercontent.com/87339748/130362110-0bc3744a-a79b-4f79-b58d-af3f82cd1d44.png) ![image](https://user-images.githubusercontent.com/87339748/130362119-d4f7c2f4-3de1-47a4-a945-abbf5282771c.png)
Figure 5: Comparison of the first and fourth layers of surface’s image. Screenshot from the PLEASE program on the left with the default patch size of 8, and on the right Gnuplot graph of outputted IV data from patch points.

![image](https://user-images.githubusercontent.com/87339748/130362147-a303c581-4974-4f21-a97c-fe4f47a9a025.png) ![image](https://user-images.githubusercontent.com/87339748/130362157-c14ae18f-454e-4c2a-8464-80e6e74d4166.png)
Figure 6: Added modification of patch width change. Size 4 set in the configuration tab, compared to size 8 it is a lot smaller and precise into the finer fourth layer. Gnuplot graph to the right shows differences in peaks compared to the size 8 curve.

![image](https://user-images.githubusercontent.com/87339748/130362172-7de1c3fe-2432-466a-81c2-df0bd1be3032.png)
Figure 7: Last changed patch size width with new development to size 2. More definite in the image’s surface. Able to clearly pinpoint the fourth layer’s IV curve without strain of blending layers together. Gnuplot graph to the left shows increased differences in first and fourth layers- prove as enhanced method of extracted output IV compared to patch size 8.

